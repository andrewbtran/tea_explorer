{
    "collab_server" : "",
    "contents" : "\n# This is the server logic for a Shiny web application.\n# You can find out more about building applications with Shiny here:\n#\n# http://shiny.rstudio.com\n#\n\nlibrary(shiny)\nlibrary(tidycensus)\nlibrary(tigris)\nlibrary(censusapi)\nsource(\"key.R\")\nlibrary(tidyverse)\nlibrary(ggmap)\nlibrary(viridis)\n\ncensus_api_key(key)\n\nshinyServer(function(input, output) {\n\n  output$choose_proj <- renderUI({\n    state_abb <- input$state \n    proj_list <- filter(teas, state==state_abb)\n    \n    selectInput(\"project\", \"Choose a project:\", \n                choices = proj_list$selector)\n  })\n  \n  \n  output$Plot <- renderPlot({\n    state_abb <- input$state \n    \n    proj_name <- input$project\n    #filter(teas, selector==proj_name)\n    \n    unemployment <- get_acs(geography=\"tract\", endyear=2015, variables= c(\"B23025_005E\", \"B23025_002E\"),  state=state_abb)\n    unemployment$moe <- NULL\n    unemployment <- spread(unemployment, variable, estimate)\n    unemployment$per_un <- round(unemployment[,4]/unemployment[,3]*100,2)\n    unemployment$rank <- rank(unemployment$per_un)\n    unemployment$per_un <- unemployment$per_un$B23025_005\n    single_proj <- filter(teas, selector==proj_name)\n    tracts <- unlist(single_proj$tracts_list)\n    #tracts <- c(\"34017004400\", \"34017004500\")\n    #unemployment <- data.frame(unemployment)\n    unemployment <- filter(unemployment, GEOID %in% tracts)\n    names(unemployment)[names(unemployment) == 'GEOID'] <- 'id'\n    \n    state_map <- tracts(state_abb, cb=F)\n    state_map <- fortify(state_map, region=\"GEOID\")\n    state_map <- left_join(state_map, unemployment)\n    state_map <- filter(state_map, !is.na(rank))\n    \n    addy <- geocode(location=single_proj$project_address, output=\"latlon\", source=\"google\")\n    location <- c(addy$lat, addy$lon)\n    \n    map <- ggplot()\n    #nj_map <- nj_map + geom_polygon(data=nj_hf, aes(x=long, y=lat, group=group), fill=NA, color=\"black\", size=.1)\n    map <- map + geom_polygon(data=state_map, aes(x=long, y=lat, group=group, fill=per_un), color=\"black\", size=.5)\n    #nj_map <- nj_map + facet_wrap(~year)\n    map <- map + coord_map() \n    map <- map + scale_fill_viridis(option = \"inferno\", direction=-1, name = \"Unemployment rate\")\n    map <- map + scale_color_viridis(option = \"inferno\", direction=-1)\n    map <- map + theme_nothing(legend=TRUE) \n    map <- map + labs(x=NULL, y=NULL, title= proj_name)\n    map <- map + theme(panel.grid.major = element_line(colour = NA))\n    map <- map + theme(text = element_text(size=15))\n    map <- map + theme(plot.title=element_text(face=\"bold\", hjust=.4))\n    map <- map + theme(plot.subtitle=element_text(face=\"italic\", size=9, margin=margin(l=20)))\n    map <- map + theme(plot.caption=element_text(size=12, margin=margin(t=12), color=\"#7a7d7e\", hjust=0))\n    map <- map + theme(legend.key.size = unit(1, \"cm\"))\n    #map <- map + annotate(\"segment\", x = -74.063644, xend = -74.035, y = 40.734330, yend = 40.734330, colour = \"tomato\", size=.5) \n    map <- map + annotate(\"point\", x = addy$lon, y = addy$lat, colour = \"red\", size = 1) \n    #map <- map + annotate(\"text\", x = -74.01, y = 40.734330, label = \"1 Journal Square\", size=3, colour=\"gray30\") \n    \n    print(map)\n  })\n  \n  \n  output$table <- renderDataTable({\n    proj_name <- input$project\n    filter(teas, selector==proj_name)\n\n    unemployment <- get_acs(geography=\"tract\", endyear=2015, variables= c(\"B23025_005E\", \"B23025_002E\"),  state=state_abb)\n    unemployment$moe <- NULL\n    unemployment <- spread(unemployment, variable, estimate)\n    unemployment$per_un <- round(unemployment[,4]/unemployment[,3]*100,2)\n    unemployment$rank <- rank(unemployment$per_un)\n    unemployment$per_un <- unemployment$per_un$B23025_005\n    single_proj <- filter(teas, selector==proj_name)\n    tracts <- unlist(single_proj$tracts_list)\n    #tracts <- c(\"34017004400\", \"34017004500\")\n    #unemployment <- data.frame(unemployment)\n    unemployment <- filter(unemployment, GEOID %in% tracts)\n    un_rate <- round(sum(unemployment$B23025_005) / sum(unemployment$B23025_002) *100,2)\n    unemployment$NAME <- gsub(\",.*\", \"\", unemployment$NAME)\n    select(unemployment, tract=NAME, `percent unemployment`=per_un, rank)\n  })\n  \n})\n",
    "created" : 1499354733083.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4055450253",
    "id" : "A520F938",
    "lastKnownWriteTime" : 1499437187,
    "last_content_update" : 1499437187504,
    "path" : "~/Documents/Github/2017/07/tea_explorer/server.R",
    "project_path" : "server.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}